# Définir le compilateur et les options
CC = gcc
CFLAGS = -Wall -fPIC
LDFLAGS = -shared -ldl

# Répertoires
SRC_DIR = src
OBJ_DIR = obj

# Fichiers sources et objets
SRCS = malware.c $(SRC_DIR)/persistence.c
OBJS = malware.o persistence.o
BLOCK_FIC_SO = block_fic.so
EXEC = malware

# Règle principale
all: $(EXEC) $(BLOCK_FIC_SO)

# Compilation de l'exécutable malware
$(EXEC): $(OBJS)
	$(CC) $(OBJS) -o $(EXEC)

# Compilation des fichiers objets
malware.o: malware.c
	$(CC) $(CFLAGS) -c malware.c -o malware.o

persistence.o: $(SRC_DIR)/persistence.c
	$(CC) $(CFLAGS) -c $(SRC_DIR)/persistence.c -o persistence.o

# Compilation de block_fic.so (librairie partagée)
$(BLOCK_FIC_SO): $(SRC_DIR)/block_fic.c
	$(CC) $(CFLAGS) -shared -o $(BLOCK_FIC_SO) $(SRC_DIR)/block_fic.c $(LDFLAGS)

# Nettoyage
clean:
	rm -f $(OBJS) $(EXEC) $(BLOCK_FIC_SO)

# Installation
install: all
	cp $(EXEC) /usr/bin/
	cp $(BLOCK_FIC_SO) /usr/lib/

.PHONY: all clean install
